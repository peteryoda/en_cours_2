!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.brainifytracker=e()}}(function(){var define,module,exports;return function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return r(n?n:e)},l,l.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){!function(e,o){"function"==typeof define&&define.amd?define(o):"undefined"!=typeof n?t.exports=o():e.atmosphere=o()}(this,function(){"use strict";var e,t={},n=!1,o=[],r=[],i=0,a=Object.prototype.hasOwnProperty;return t={version:"2.3.2-javascript",onError:function(e){},onClose:function(e){},onOpen:function(e){},onReopen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){},WebsocketApiAdapter:function(e){var n,o;return e.onMessage=function(e){o.onmessage({data:e.responseBody})},e.onMessagePublished=function(e){o.onmessage({data:e.responseBody})},e.onOpen=function(e){o.onopen(e)},o={close:function(){n.close()},send:function(e){n.push(e)},onmessage:function(e){},onopen:function(e){},onclose:function(e){},onerror:function(e){}},n=new t.subscribe(e),o},AtmosphereRequest:function(e){function o(){ye=!0,xe=!1,we=0,me=null,ge=null,ve=null,he=null}function a(){f(),o()}function s(e){return"debug"==e?"debug"===fe.logLevel:"info"==e?"info"===fe.logLevel||"debug"===fe.logLevel:"warn"==e?"warn"===fe.logLevel||"info"===fe.logLevel||"debug"===fe.logLevel:"error"==e&&("error"===fe.logLevel||"warn"===fe.logLevel||"info"===fe.logLevel||"debug"===fe.logLevel)}function c(e){s("debug")&&t.util.debug(new Date+" Atmosphere: "+e)}function u(e,t){return""===pe.partialMessage&&"streaming"===t.transport&&e.responseText.length>t.maxStreamingLength}function l(){if(fe.enableProtocol&&!fe.disableDisconnect&&!fe.firstMessage){var e="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+fe.uuid;t.util.each(fe.headers,function(n,o){var r=t.util.isFunction(o)?o.call(this,fe,fe,pe):o;null!=r&&(e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(r))});var n=fe.url.replace(/([?&])_=[^&]*/,e);n+=n===fe.url?(/\?/.test(fe.url)?"&":"?")+e:"";var o={connected:!1},r=new t.AtmosphereRequest(o);r.connectTimeout=fe.connectTimeout,r.attachHeadersAsQueryString=!1,r.dropHeaders=!0,r.url=n,r.contentType="text/plain",r.transport="polling",r.method="GET",r.data="",r.heartbeat=null,fe.enableXDR&&(r.enableXDR=fe.enableXDR),r.async=fe.closeAsync,W("",r)}}function d(){c("Closing (AtmosphereRequest._close() called)"),xe=!0,fe.reconnectId&&(clearTimeout(fe.reconnectId),delete fe.reconnectId),fe.heartbeatTimer&&clearTimeout(fe.heartbeatTimer),fe.reconnect=!1,pe.request=fe,pe.state="unsubscribe",pe.responseBody="",pe.status=408,pe.partialMessage="",ce(),l(),f()}function f(){pe.partialMessage="",fe.id&&clearTimeout(fe.id),fe.heartbeatTimer&&clearTimeout(fe.heartbeatTimer),fe.reconnectId&&(clearTimeout(fe.reconnectId),delete fe.reconnectId),null!=he&&(he.close(),he=null),null!=be&&(be.abort(),be=null),null!=ve&&(ve.abort(),ve=null),null!=me&&(me.canSendMessage&&(c("invoking .close() on WebSocket object"),me.close()),me=null),null!=ge&&(ge.close(),ge=null),p()}function p(){null!=ue&&(clearInterval(le),document.cookie=de+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",ue.signal("close",{reason:"",heir:xe?(ue.get("children")||[])[0]:_e}),ue.close()),null!=Ce&&Ce.close()}function m(e){a(),fe=t.util.extend(fe,e),fe.mrequest=fe.reconnect,fe.reconnect||(fe.reconnect=!0)}function g(){return null!=fe.webSocketImpl||window.WebSocket||window.MozWebSocket}function v(){var e=t.util.getAbsoluteURL(fe.url.toLowerCase()),n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(e),o=!(!n||n[1]==window.location.protocol&&n[2]==window.location.hostname&&(n[3]||("http:"===n[1]?80:443))==(window.location.port||("http:"===window.location.protocol?80:443)));return window.EventSource&&(!o||!t.util.browser.safari||t.util.browser.vmajor>=7)}function h(){if(fe.shared){if(Ce=b(fe),null!=Ce&&(s("debug")&&t.util.debug("Storage service available. All communication will be local"),Ce.open(fe)))return;s("debug")&&t.util.debug("No Storage service available."),Ce=null}fe.firstMessage=0==i,fe.isOpen=!1,fe.ctime=t.util.now(),0===fe.uuid&&(fe.uuid=i),pe.closedByClientTimeout=!1,"websocket"!==fe.transport&&"sse"!==fe.transport?P(fe):"websocket"===fe.transport?g()?_(!1):j("Websocket is not supported, using request.fallbackTransport ("+fe.fallbackTransport+")"):"sse"===fe.transport&&(v()?C(!1):j("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+fe.fallbackTransport+")"))}function b(e){function n(e,t){var n,o=e.length;for(n=0;n<o;n++)e[n]===t&&e.splice(n,1);return o!==e.length}function o(n){var o=t.util.parseJSON(n),r=o.data;if("c"===o.target)switch(o.type){case"open":w("opening","local",fe);break;case"close":s||(s=!0,"aborted"===r.reason?d():r.heir===_e?h():setTimeout(function(){h()},100));break;case"message":oe(r,"messageReceived",200,e.transport);break;case"localMessage":ne(r)}}function r(){var e=new RegExp("(?:^|; )("+encodeURIComponent(c)+")=([^;]*)").exec(document.cookie);if(e)return t.util.parseJSON(decodeURIComponent(e[2]))}var i,a,s,c="atmosphere-"+e.url,u={storage:function(){function r(e){e.key===c&&e.newValue&&o(e.newValue)}if(t.util.storage){var i=window.localStorage,a=function(e){return t.util.parseJSON(i.getItem(c+"-"+e))},s=function(e,n){i.setItem(c+"-"+e,t.util.stringifyJSON(n))};return{init:function(){return s("children",a("children").concat([_e])),t.util.on(window,"storage",r),a("opened")},signal:function(e,n){i.setItem(c,t.util.stringifyJSON({target:"p",type:e,data:n}))},close:function(){var o=a("children");t.util.off(window,"storage",r),o&&n(o,e.id)&&s("children",o)}}}},windowref:function(){var e=window.open("",c.replace(/\W/g,""));if(e&&!e.closed&&e.callbacks)return{init:function(){return e.callbacks.push(o),e.children.push(_e),e.opened},signal:function(n,o){!e.closed&&e.fire&&e.fire(t.util.stringifyJSON({target:"p",type:n,data:o}))},close:function(){s||(n(e.callbacks,o),n(e.children,_e))}}}};if(i=r(),i&&!(t.util.now()-i.ts>1e3)&&(a=u.storage()||u.windowref()))return{open:function(){var n;return le=setInterval(function(){var e=i;i=r(),i&&e.ts!==i.ts||o(t.util.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:e.heir}}))},1e3),n=a.init(),n&&setTimeout(function(){w("opening","local",e)},50),n},send:function(e){a.signal("send",e)},localSend:function(e){a.signal("localSend",t.util.stringifyJSON({id:_e,event:e}))},close:function(){xe||(clearInterval(le),a.signal("close"),a.close())}}}function y(){function e(e){var n=t.util.parseJSON(e),o=n.data;if("p"===n.target)switch(n.type){case"send":z(o);break;case"localSend":ne(o);break;case"close":d()}}function n(){document.cookie=de+"="+encodeURIComponent(t.util.stringifyJSON({ts:t.util.now()+1,heir:(o.get("children")||[])[0]}))+"; path=/"}var o,r="atmosphere-"+fe.url,i={storage:function(){function n(t){t.key===r&&t.newValue&&e(t.newValue)}if(t.util.storage){var o=window.localStorage;return{init:function(){t.util.on(window,"storage",n)},signal:function(e,n){o.setItem(r,t.util.stringifyJSON({target:"c",type:e,data:n}))},get:function(e){return t.util.parseJSON(o.getItem(r+"-"+e))},set:function(e,n){o.setItem(r+"-"+e,t.util.stringifyJSON(n))},close:function(){t.util.off(window,"storage",n),o.removeItem(r),o.removeItem(r+"-opened"),o.removeItem(r+"-children")}}}},windowref:function(){var n,o=r.replace(/\W/g,""),i=document.getElementById(o);return i||(i=document.createElement("div"),i.id=o,i.style.display="none",i.innerHTML='<iframe name="'+o+'" />',document.body.appendChild(i)),n=i.firstChild.contentWindow,{init:function(){n.callbacks=[e],n.fire=function(e){var t;for(t=0;t<n.callbacks.length;t++)n.callbacks[t](e)}},signal:function(e,o){!n.closed&&n.fire&&n.fire(t.util.stringifyJSON({target:"c",type:e,data:o}))},get:function(e){return n.closed?null:n[e]},set:function(e,t){n.closed||(n[e]=t)},close:function(){}}}};Se=function(e){o.signal("message",e)},o=i.storage()||i.windowref(),o.init(),s("debug")&&t.util.debug("Installed StorageService "+o),o.set("children",[]),null==o.get("opened")||o.get("opened")||o.set("opened",!1),de=encodeURIComponent(r),n(),le=setInterval(n,1e3),ue=o}function w(e,t,n){if(fe.shared&&"local"!==t&&y(),null!=ue&&ue.set("opened",!0),n.close=function(){d()},we>0&&"re-connecting"===e)n.isReopen=!0,B(pe);else if(null==pe.error){pe.request=n;var o=pe.state;pe.state=e;var r=pe.transport;pe.transport=t;var i=pe.responseBody;ce(),pe.responseBody=i,pe.state=o,pe.transport=r}}function k(e){e.transport="jsonp";var n,o=fe;null!=e&&"undefined"!=typeof e&&(o=e),be={open:function(){function r(){o.lastIndex=0,o.openId&&clearTimeout(o.openId),o.heartbeatTimer&&clearTimeout(o.heartbeatTimer),o.reconnect&&we++<o.maxReconnectOnClose?(w("re-connecting",o.transport,o),N(be,o,e.reconnectInterval),o.openId=setTimeout(function(){D(o)},o.reconnectInterval+1e3)):E(0,"maxReconnectOnClose reached")}function i(){var t=o.url;null!=o.dispatchUrl&&(t+=o.dispatchUrl);var i=o.data;o.attachHeadersAsQueryString&&(t=H(o),""!==i&&(t+="&X-Atmosphere-Post-Body="+encodeURIComponent(i)),i="");var s=document.head||document.getElementsByTagName("head")[0]||document.documentElement;n=document.createElement("script"),n.src=t+"&jsonpTransport="+a,n.clean=function(){n.clean=n.onerror=n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),2===++e.scriptCount&&(e.scriptCount=1,r())},n.onload=n.onreadystatechange=function(){c("jsonp.onload"),n.readyState&&!/loaded|complete/.test(n.readyState)||n.clean()},n.onerror=function(){c("jsonp.onerror"),e.scriptCount=1,n.clean()},s.insertBefore(n,s.firstChild)}var a="atmosphere"+ ++_e;window[a]=function(n){if(c("jsonp.window"),e.scriptCount=0,o.reconnect&&o.maxRequest===-1||o.requestCount++<o.maxRequest){if(o.executeCallbackBeforeReconnect||N(be,o,o.pollingInterval),null!=n&&"string"!=typeof n)try{n=n.message}catch(e){}var r=O(n,o,pe);r||oe(pe.responseBody,"messageReceived",200,o.transport),o.executeCallbackBeforeReconnect&&N(be,o,o.pollingInterval),R(o)}else t.util.log(fe.logLevel,["JSONP reconnect maximum try reached "+fe.requestCount]),E(0,"maxRequest reached")},setTimeout(function(){i()},50)},abort:function(){n&&n.clean&&n.clean()}},be.open()}function T(e){return null!=fe.webSocketImpl?fe.webSocketImpl:window.WebSocket?new WebSocket(e):new MozWebSocket(e)}function x(){return H(fe,t.util.getAbsoluteURL(fe.webSocketUrl||fe.url)).replace(/^http/,"ws")}function S(){var e=H(fe);return e}function C(e){pe.transport="sse";var n=S();if(s("debug")&&(t.util.debug("Invoking executeSSE"),t.util.debug("Using URL: "+n)),e&&!fe.reconnect)return void(null!=ge&&f());try{ge=new EventSource(n,{withCredentials:fe.withCredentials})}catch(e){return E(0,e),void j("SSE failed. Downgrading to fallback transport and resending")}fe.connectTimeout>0&&(fe.id=setTimeout(function(){e||f()},fe.connectTimeout)),ge.onopen=function(n){c("sse.onopen"),R(fe),s("debug")&&t.util.debug("SSE successfully opened"),fe.enableProtocol?fe.isReopen&&(fe.isReopen=!1,w("re-opening",fe.transport,fe)):e?w("re-opening","sse",fe):w("opening","sse",fe),e=!0,"POST"===fe.method&&(pe.state="messageReceived",ge.send(fe.data))},ge.onmessage=function(e){if(c("sse.onmessage"),R(fe),!fe.enableXDR&&window.location.host&&e.origin&&e.origin!==window.location.protocol+"//"+window.location.host)return void t.util.log(fe.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);pe.state="messageReceived",pe.status=200,e=e.data;var n=O(e,fe,pe);n||(ce(),pe.responseBody="",pe.messages=[])},ge.onerror=function(n){c("sse.onerror"),clearTimeout(fe.id),fe.heartbeatTimer&&clearTimeout(fe.heartbeatTimer),pe.closedByClientTimeout||(se(e),f(),xe?t.util.log(fe.logLevel,["SSE closed normally"]):e?fe.reconnect&&"sse"===pe.transport&&(we++<fe.maxReconnectOnClose?(w("re-connecting",fe.transport,fe),fe.reconnectInterval>0?fe.reconnectId=setTimeout(function(){C(!0)},fe.reconnectInterval):C(!0),pe.responseBody="",pe.messages=[]):(t.util.log(fe.logLevel,["SSE reconnect maximum try reached "+we]),E(0,"maxReconnectOnClose reached"))):j("SSE failed. Downgrading to fallback transport and resending"))}}function _(e){pe.transport="websocket";var o=x(fe.url);if(s("debug")&&t.util.debug("Invoking executeWebSocket, using URL: "+o),e&&!fe.reconnect)return void(null!=me&&f());me=T(o),null!=fe.webSocketBinaryType&&(me.binaryType=fe.webSocketBinaryType),fe.connectTimeout>0&&(fe.id=setTimeout(function(){if(e);else{var t={code:1002,reason:"",wasClean:!1};me.onclose(t);try{f()}catch(e){}}},fe.connectTimeout)),me.onopen=function(o){c("websocket.onopen"),R(fe),n=!1,s("debug")&&t.util.debug("Websocket successfully opened");var r=e;null!=me&&(me.canSendMessage=!0),fe.enableProtocol||(e=!0,r?w("re-opening","websocket",fe):w("opening","websocket",fe)),null!=me&&"POST"===fe.method&&(pe.state="messageReceived",me.send(fe.data))},me.onmessage=function(t){c("websocket.onmessage"),R(fe),fe.enableProtocol&&(e=!0),pe.state="messageReceived",pe.status=200,t=t.data;var n="string"==typeof t;if(n){var o=O(t,fe,pe);o||(ce(),pe.responseBody="",pe.messages=[])}else{if(t=I(fe,t),""===t)return;pe.responseBody=t,ce(),pe.responseBody=null}},me.onerror=function(e){c("websocket.onerror"),clearTimeout(fe.id),fe.heartbeatTimer&&clearTimeout(fe.heartbeatTimer)},me.onclose=function(o){if(c("websocket.onclose"),clearTimeout(fe.id),"closed"!==pe.state){var r=o.reason;if(""===r)switch(o.code){case 1e3:r="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:r="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:r="The endpoint is terminating the connection due to a protocol error.";break;case 1003:r="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:r="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:r="Unknown: no status code was provided even though one was expected.";break;case 1006:r="Connection was closed abnormally (that is, with no close frame being sent)."}if(s("warn")&&t.util.warn("Websocket closed, reason: "+r+" - wasClean: "+o.wasClean),pe.closedByClientTimeout||fe.handleOnlineOffline&&n)return void(fe.reconnectId&&(clearTimeout(fe.reconnectId),delete fe.reconnectId));se(e),pe.state="closed",xe?t.util.log(fe.logLevel,["Websocket closed normally"]):e?fe.reconnect&&"websocket"===pe.transport&&(f(),we++<fe.maxReconnectOnClose?(w("re-connecting",fe.transport,fe),fe.reconnectInterval>0?fe.reconnectId=setTimeout(function(){pe.responseBody="",pe.messages=[],_(!0)},fe.reconnectInterval):(pe.responseBody="",pe.messages=[],_(!0))):(t.util.log(fe.logLevel,["Websocket reconnect maximum try reached "+we]),s("warn")&&t.util.warn("Websocket error, reason: "+o.reason),E(0,"maxReconnectOnClose reached"))):j("Websocket failed on first connection attempt. Downgrading to "+fe.fallbackTransport+" and resending")}};var r=navigator.userAgent.toLowerCase(),i=r.indexOf("android")>-1;i&&void 0===me.url&&me.onclose({reason:"Android 4.1 does not support websockets.",wasClean:!1})}function I(e,n){var o=n;if("polling"===e.transport)return o;if(e.enableProtocol&&e.firstMessage&&0!==t.util.trim(n).length){var r=e.trackMessageLength?1:0,a=n.split(e.messageDelimiter);if(a.length<=r+1)return o;if(e.firstMessage=!1,e.uuid=t.util.trim(a[r]),a.length<=r+2&&t.util.log("error",["Protocol data not sent by the server. If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side.Also note that atmosphere-runtime 2.2+ should be used."]),ke=parseInt(t.util.trim(a[r+1]),10),Te=a[r+2],"long-polling"!==e.transport&&D(e),i=e.uuid,o="",r=e.trackMessageLength?4:3,a.length>r+1)for(var s=r;s<a.length;s++)o+=a[s],s+1!==a.length&&(o+=e.messageDelimiter);0!==e.ackInterval&&setTimeout(function(){z("...ACK...")},e.ackInterval)}else e.enableProtocol&&e.firstMessage&&t.util.browser.msie&&+t.util.browser.version.split(".")[0]<10?t.util.log(fe.logLevel,["Receiving unexpected data from IE"]):D(e);return o}function R(e){clearTimeout(e.id),e.timeout>0&&"polling"!==e.transport&&(e.id=setTimeout(function(){A(e),l(),f()},e.timeout))}function A(e){pe.closedByClientTimeout=!0,pe.state="closedByClient",pe.responseBody="",pe.status=408,pe.messages=[],ce()}function E(e,t){f(),clearTimeout(fe.id),pe.state="error",pe.reasonPhrase=t,pe.responseBody="",pe.status=e,pe.messages=[],ce()}function O(e,t,n){if(e=I(t,e),0===e.length)return!0;if(n.responseBody=e,t.trackMessageLength){e=n.partialMessage+e;var o=[],r=e.indexOf(t.messageDelimiter);if(r!=-1){for(;r!==-1;){var i=e.substring(0,r),a=+i;if(isNaN(a))throw new Error('message length "'+i+'" is not a number');r+=t.messageDelimiter.length,r+a>e.length?r=-1:(o.push(e.substring(r,r+a)),e=e.substring(r+a,e.length),r=e.indexOf(t.messageDelimiter))}return n.partialMessage=e,0!==o.length?(n.responseBody=o.join(t.messageDelimiter),n.messages=o,!1):(n.responseBody="",n.messages=[],!0)}}return n.responseBody=e,n.messages=[e],!1}function j(e){t.util.log(fe.logLevel,[e]),"undefined"!=typeof fe.onTransportFailure?fe.onTransportFailure(e,fe):"undefined"!=typeof t.util.onTransportFailure&&t.util.onTransportFailure(e,fe),fe.transport=fe.fallbackTransport;var n=fe.connectTimeout===-1?0:fe.connectTimeout;fe.reconnect&&"none"!==fe.transport||null==fe.transport?(fe.method=fe.fallbackMethod,pe.transport=fe.fallbackTransport,fe.fallbackTransport="none",n>0?fe.reconnectId=setTimeout(function(){h()},n):h()):E(500,"Unable to reconnect with fallback transport")}function H(e,n){var o=fe;return null!=e&&"undefined"!=typeof e&&(o=e),null==n&&(n=o.url),o.attachHeadersAsQueryString?n.indexOf("X-Atmosphere-Framework")!==-1?n:(n+=n.indexOf("?")!==-1?"&":"?",n+="X-Atmosphere-tracking-id="+o.uuid,n+="&X-Atmosphere-Framework="+t.version,n+="&X-Atmosphere-Transport="+o.transport,o.trackMessageLength&&(n+="&X-Atmosphere-TrackMessageSize=true"),null!==o.heartbeat&&null!==o.heartbeat.server&&(n+="&X-Heartbeat-Server="+o.heartbeat.server),""!==o.contentType&&(n+="&Content-Type="+("websocket"===o.transport?o.contentType:encodeURIComponent(o.contentType))),o.enableProtocol&&(n+="&X-atmo-protocol=true"),t.util.each(o.headers,function(r,i){var a=t.util.isFunction(i)?i.call(this,o,e,pe):i;null!=a&&(n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(a))}),n):n}function D(e){if(e.isOpen)if(e.isReopen)e.isReopen=!1,w("re-opening",e.transport,e);else{if("messageReceived"!==pe.state||"jsonp"!==e.transport&&"long-polling"!==e.transport)return;U(pe)}else e.isOpen=!0,w("opening",e.transport,e);M(e)}function M(e){if(null!=e.heartbeatTimer&&clearTimeout(e.heartbeatTimer),!isNaN(ke)&&ke>0){var n=function(){s("debug")&&t.util.debug("Sending heartbeat"),z(Te),e.heartbeatTimer=setTimeout(n,ke)};e.heartbeatTimer=setTimeout(n,ke)}}function P(e){var n=fe;if(null==e&&"undefined"==typeof e||(n=e),n.lastIndex=0,n.readyState=0,"jsonp"===n.transport||n.enableXDR&&t.util.checkCORSSupport())return void k(n);if(t.util.browser.msie&&+t.util.browser.version.split(".")[0]<10){if("streaming"===n.transport)return void(n.enableXDR&&window.XDomainRequest?F(n):J(n));if(n.enableXDR&&window.XDomainRequest)return void F(n)}var o=function(t){if(n.lastIndex=0,we++,t||n.reconnect&&we<=n.maxReconnectOnClose){var o=t?0:e.reconnectInterval;pe.ffTryingReconnect=!0,w("re-connecting",e.transport,e),N(a,n,o)}else E(0,"maxReconnectOnClose reached")},r=function(e){t._beforeUnloadState?(t.util.debug(new Date+" Atmosphere: reconnectF: execution delayed due to _beforeUnloadState flag"),setTimeout(function(){o(e)},5e3)):o(e)},i=function(){pe.errorHandled=!0,f(),r(!1)};if(n.force||n.reconnect&&(n.maxRequest===-1||n.requestCount++<n.maxRequest)){n.force=!1;var a=t.util.xhr();a.hasData=!1,L(a,n,!0),n.suspend&&(ve=a),"polling"!==n.transport&&(pe.transport=n.transport,a.onabort=function(){c("ajaxrequest.onabort"),se(!0)},a.onerror=function(){c("ajaxrequest.onerror"),pe.error=!0,pe.ffTryingReconnect=!0;try{pe.status=XMLHttpRequest.status}catch(e){pe.status=500}pe.status||(pe.status=500),pe.errorHandled||(f(),r(!1))}),a.onreadystatechange=function(){if(c("ajaxRequest.onreadystatechange, new state: "+a.readyState),xe)return void c("onreadystatechange has been ignored due to _abortingConnection flag");pe.error=null;var o=!1,s=!1;if("streaming"===n.transport&&n.readyState>2&&4===a.readyState)return f(),void r(!1);if(n.readyState=a.readyState,"streaming"===n.transport&&a.readyState>=3?s=!0:"long-polling"===n.transport&&4===a.readyState&&(s=!0),R(fe),"polling"!==n.transport){var l=200;if(4===a.readyState&&(l=a.status>1e3?0:a.status),!n.reconnectOnServerError&&l>=300&&l<600)return void E(l,a.statusText);if(l>=300||0===l)return void i();n.enableProtocol&&e.firstMessage||2!==a.readyState||(t.util.browser.mozilla&&pe.ffTryingReconnect?(pe.ffTryingReconnect=!1,setTimeout(function(){pe.ffTryingReconnect||D(n)},500)):D(n))}else 4===a.readyState&&(s=!0);if(s){var d=a.responseText;if(pe.errorHandled=!1,"long-polling"===n.transport&&0===t.util.trim(d).length)return void(a.hasData?a.hasData=!1:r(!0));if(a.hasData=!0,re(a,fe),"streaming"===n.transport)if(t.util.browser.opera)t.util.iterate(function(){if(500!==pe.status&&a.responseText.length>n.lastIndex){try{pe.status=a.status,pe.headers=t.util.parseHeaders(a.getAllResponseHeaders()),re(a,fe)}catch(e){pe.status=404}R(fe),pe.state="messageReceived";var e=a.responseText.substring(n.lastIndex);if(n.lastIndex=a.responseText.length,o=O(e,n,pe),o||ce(),u(a,n))return void q(a,n)}else if(pe.status>400)return n.lastIndex=a.responseText.length,!1},0);else{var p=d.substring(n.lastIndex,d.length);if(o=O(p,n,pe),n.lastIndex=d.length,o)return}else o=O(d,n,pe);var m=u(a,n);try{pe.status=a.status,pe.headers=t.util.parseHeaders(a.getAllResponseHeaders()),re(a,n)}catch(e){pe.status=404}n.suspend?pe.state=0===pe.status?"closed":"messageReceived":pe.state="messagePublished";var g=!m&&"streaming"!==e.transport&&"polling"!==e.transport;g&&!n.executeCallbackBeforeReconnect&&N(a,n,n.pollingInterval),0===pe.responseBody.length||o||ce(),g&&n.executeCallbackBeforeReconnect&&N(a,n,n.pollingInterval),m&&q(a,n)}};try{a.send(n.data),ye=!0}catch(e){t.util.log(n.logLevel,["Unable to connect to "+n.url]),E(0,e)}}else"debug"===n.logLevel&&t.util.log(n.logLevel,["Max re-connection reached."]),E(0,"maxRequest reached")}function q(e,t){pe.messages=[],t.isReopen=!0,d(),xe=!1,N(e,t,500)}function L(e,n,o){var r=n.url;null!=n.dispatchUrl&&"POST"===n.method&&(r+=n.dispatchUrl),r=H(n,r),r=t.util.prepareURL(r),o&&(e.open(n.method,r,n.async),n.connectTimeout>0&&(n.id=setTimeout(function(){0===n.requestCount&&(f(),oe("Connect timeout","closed",200,n.transport))},n.connectTimeout))),fe.withCredentials&&"websocket"!==fe.transport&&"withCredentials"in e&&(e.withCredentials=!0),fe.dropHeaders||(e.setRequestHeader("X-Atmosphere-Framework",t.version),e.setRequestHeader("X-Atmosphere-Transport",n.transport),null!==n.heartbeat&&null!==n.heartbeat.server&&e.setRequestHeader("X-Heartbeat-Server",e.heartbeat.server),n.trackMessageLength&&e.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),e.setRequestHeader("X-Atmosphere-tracking-id",n.uuid),t.util.each(n.headers,function(r,i){var a=t.util.isFunction(i)?i.call(this,e,n,o,pe):i;null!=a&&e.setRequestHeader(r,a)})),""!==n.contentType&&e.setRequestHeader("Content-Type",n.contentType)}function N(e,t,n){if(!pe.closedByClientTimeout&&(t.reconnect||t.suspend&&ye)){var o=0;e&&e.readyState>1&&(o=e.status>1e3?0:e.status),pe.status=0===o?204:o,pe.reason=0===o?"Server resumed the connection or down.":"OK",clearTimeout(t.id),t.reconnectId&&(clearTimeout(t.reconnectId),delete t.reconnectId),n>0?fe.reconnectId=setTimeout(function(){P(t)},n):P(t)}}function B(e){e.state="re-connecting",ie(e)}function U(e){e.state="openAfterResume",ie(e),e.state="messageReceived"}function F(e){"polling"!==e.transport?(he=X(e),he.open()):X(e).open()}function X(e){var n=fe;null!=e&&"undefined"!=typeof e&&(n=e);var o=n.transport,r=0,i=new window.XDomainRequest,a=function(){"long-polling"===n.transport&&n.reconnect&&(n.maxRequest===-1||n.requestCount++<n.maxRequest)&&(i.status=200,F(n))},s=n.rewriteURL||function(e){var t=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(t&&t[1]){case"JSESSIONID":return e.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+t[2]+"$1");case"PHPSESSID":return e.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+t[2]+"&").replace(/&$/,"")}return e};i.onprogress=function(){c(i)},i.onerror=function(){"polling"!==n.transport&&(f(),we++<n.maxReconnectOnClose?n.reconnectInterval>0?n.reconnectId=setTimeout(function(){w("re-connecting",e.transport,e),F(n)},n.reconnectInterval):(w("re-connecting",e.transport,e),F(n)):E(0,"maxReconnectOnClose reached"))},i.onload=function(){};var c=function(e){clearTimeout(n.id);var i=e.responseText;if(i=i.substring(r),r+=i.length,"polling"!==o){R(n);var s=O(i,n,pe);if("long-polling"===o&&0===t.util.trim(i).length)return;n.executeCallbackBeforeReconnect&&a(),s||oe(pe.responseBody,"messageReceived",200,o),n.executeCallbackBeforeReconnect||a()}};return{open:function(){var e=n.url;null!=n.dispatchUrl&&(e+=n.dispatchUrl),e=H(n,e),i.open(n.method,s(e)),"GET"===n.method?i.send():i.send(n.data),n.connectTimeout>0&&(n.id=setTimeout(function(){0===n.requestCount&&(f(),oe("Connect timeout","closed",200,n.transport))},n.connectTimeout))},close:function(){i.abort()}}}function J(e){he=$(e),he.open()}function $(e){var n=fe;null!=e&&"undefined"!=typeof e&&(n=e);var o,r=new window.ActiveXObject("htmlfile");r.open(),r.close();var i=n.url;return null!=n.dispatchUrl&&(i+=n.dispatchUrl),"polling"!==n.transport&&(pe.transport=n.transport),{open:function(){var e=r.createElement("iframe");i=H(n),""!==n.data&&(i+="&X-Atmosphere-Post-Body="+encodeURIComponent(n.data)),i=t.util.prepareURL(i),e.src=i,r.body.appendChild(e);var a=e.contentDocument||e.contentWindow.document;o=t.util.iterate(function(){try{if(!a.firstChild)return;var e=a.body?a.body.lastChild:a,i=function(){var t=e.cloneNode(!0);t.appendChild(a.createTextNode("."));var n=t.innerText;return n=n.substring(0,n.length-1)};if(!a.body||!a.body.firstChild||"pre"!==a.body.firstChild.nodeName.toLowerCase()){var s=a.head||a.getElementsByTagName("head")[0]||a.documentElement||a,c=a.createElement("script");c.text="document.write('<plaintext>')",s.insertBefore(c,s.firstChild),s.removeChild(c),e=a.body.lastChild}return n.closed&&(n.isReopen=!0),o=t.util.iterate(function(){var t=i();if(t.length>n.lastIndex){R(fe),pe.status=200,pe.error=null,e.innerText="";var o=O(t,n,pe);if(o)return"";oe(pe.responseBody,"messageReceived",200,n.transport)}if(n.lastIndex=0,"complete"===a.readyState)return se(!0),w("re-connecting",n.transport,n),n.reconnectInterval>0?n.reconnectId=setTimeout(function(){J(n)},n.reconnectInterval):J(n),!1},null),!1}catch(e){return pe.error=!0,w("re-connecting",n.transport,n),we++<n.maxReconnectOnClose?n.reconnectInterval>0?n.reconnectId=setTimeout(function(){J(n)},n.reconnectInterval):J(n):E(0,"maxReconnectOnClose reached"),r.execCommand("Stop"),r.close(),!1}})},close:function(){o&&o(),r.execCommand("Stop"),se(!0)}}}function z(e){null!=Ce?K(e):null!=ve||null!=ge?G(e):null!=he?Y(e):null!=be?Q(e):null!=me?te(e):(E(0,"No suspended connection available"),t.util.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before trying to push data"))}function W(e,t){t||(t=ee(e)),t.transport="polling",t.method="GET",t.withCredentials=!1,t.reconnect=!1,t.force=!0,t.suspend=!1,t.timeout=1e3,P(t)}function K(e){Ce.send(e)}function V(e){if(0!==e.length)try{Ce?Ce.localSend(e):ue&&ue.signal("localMessage",t.util.stringifyJSON({id:_e,event:e}))}catch(e){t.util.error(e)}}function G(e){var t=ee(e);P(t)}function Y(e){if(fe.enableXDR&&t.util.checkCORSSupport()){var n=ee(e);n.reconnect=!1,k(n)}else G(e)}function Q(e){G(e)}function Z(e){var t=e;return"object"==typeof t&&(t=e.data),t}function ee(e){var n=Z(e),o={connected:!1,timeout:6e4,method:"POST",url:fe.url,contentType:fe.contentType,headers:fe.headers,reconnect:!0,callback:null,data:n,suspend:!1,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:fe.withCredentials,async:fe.async,transport:"polling",isOpen:!0,attachHeadersAsQueryString:!0,enableXDR:fe.enableXDR,uuid:fe.uuid,dispatchUrl:fe.dispatchUrl,enableProtocol:!1,messageDelimiter:"|",trackMessageLength:fe.trackMessageLength,maxReconnectOnClose:fe.maxReconnectOnClose,heartbeatTimer:fe.heartbeatTimer,heartbeat:fe.heartbeat};return"object"==typeof e&&(o=t.util.extend(o,e)),o}function te(e){var n,o=t.util.isBinary(e)?e:Z(e);try{if(n=null!=fe.dispatchUrl?fe.webSocketPathDelimiter+fe.dispatchUrl+fe.webSocketPathDelimiter+o:o,!me.canSendMessage)return void t.util.error("WebSocket not connected.");me.send(n)}catch(t){me.onclose=function(e){},f(),j("Websocket failed. Downgrading to "+fe.fallbackTransport+" and resending "+e),G(e)}}function ne(e){var n=t.util.parseJSON(e);n.id!==_e&&("undefined"!=typeof fe.onLocalMessage?fe.onLocalMessage(n.event):"undefined"!=typeof t.util.onLocalMessage&&t.util.onLocalMessage(n.event))}function oe(e,t,n,o){pe.responseBody=e,pe.transport=o,pe.status=n,pe.state=t,ce()}function re(e,t){if(t.readResponsesHeaders)try{var n=e.getResponseHeader("X-Atmosphere-tracking-id");n&&null!=n&&(t.uuid=n.split(" ").pop())}catch(e){}else t.enableProtocol||(t.uuid=_e)}function ie(e){ae(e,fe),ae(e,t.util)}function ae(e,t){switch(e.state){case"messageReceived":c("Firing onMessage"),we=0,"undefined"!=typeof t.onMessage&&t.onMessage(e),"undefined"!=typeof t.onmessage&&t.onmessage(e);break;case"error":var n="undefined"!=typeof e.reasonPhrase?e.reasonPhrase:"n/a";c("Firing onError, reasonPhrase: "+n),"undefined"!=typeof t.onError&&t.onError(e),"undefined"!=typeof t.onerror&&t.onerror(e);break;case"opening":delete fe.closed,c("Firing onOpen"),"undefined"!=typeof t.onOpen&&t.onOpen(e),"undefined"!=typeof t.onopen&&t.onopen(e);break;case"messagePublished":c("Firing messagePublished"),"undefined"!=typeof t.onMessagePublished&&t.onMessagePublished(e);break;case"re-connecting":c("Firing onReconnect"),"undefined"!=typeof t.onReconnect&&t.onReconnect(fe,e);break;case"closedByClient":c("Firing closedByClient"),"undefined"!=typeof t.onClientTimeout&&t.onClientTimeout(fe);break;case"re-opening":delete fe.closed,c("Firing onReopen"),"undefined"!=typeof t.onReopen&&t.onReopen(fe,e);break;case"fail-to-reconnect":c("Firing onFailureToReconnect"),"undefined"!=typeof t.onFailureToReconnect&&t.onFailureToReconnect(fe,e);break;case"unsubscribe":case"closed":var o="undefined"!=typeof fe.closed&&fe.closed;o?c("Request already closed, not firing onClose ("+e.state+" case)"):(c("Firing onClose ("+e.state+" case)"),"undefined"!=typeof t.onClose&&t.onClose(e),"undefined"!=typeof t.onclose&&t.onclose(e)),fe.closed=!0;break;case"openAfterResume":"undefined"!=typeof t.onOpenAfterResume&&t.onOpenAfterResume(fe)}}function se(e){"closed"!==pe.state&&(pe.state="closed",pe.responseBody="",pe.messages=[],pe.status=e?200:501,ce())}function ce(){var e=function(e,t){t(pe)};null==Ce&&null!=Se&&Se(pe.responseBody),fe.reconnect=fe.mrequest;for(var n="string"==typeof pe.responseBody,o=n&&fe.trackMessageLength?pe.messages.length>0?pe.messages:[""]:new Array(pe.responseBody),i=0;i<o.length;i++)if(!(o.length>1&&0===o[i].length||(pe.responseBody=n?t.util.trim(o[i]):o[i],
null==Ce&&null!=Se&&Se(pe.responseBody),(0===pe.responseBody.length||n&&Te===pe.responseBody)&&"messageReceived"===pe.state))){if(ie(pe),r.length>0){s("debug")&&t.util.debug("Invoking "+r.length+" global callbacks: "+pe.state);try{t.util.each(r,e)}catch(e){t.util.log(fe.logLevel,["Callback exception"+e])}}if("function"==typeof fe.callback){s("debug")&&t.util.debug("Invoking request callbacks");try{fe.callback(pe)}catch(e){t.util.log(fe.logLevel,["Callback exception"+e])}}}}var ue,le,de,fe={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:-1,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:!1,rewriteURL:!1,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,withCredentials:!1,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:!0,uuid:0,async:!0,shared:!1,readResponsesHeaders:!1,maxReconnectOnClose:5,enableProtocol:!0,disableDisconnect:!1,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,closeAsync:!1,reconnectOnServerError:!0,handleOnlineOffline:!0,onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReopen:function(e,t){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){}},pe={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:!1,closedByClientTimeout:!1,ffTryingReconnect:!1},me=null,ge=null,ve=null,he=null,be=null,ye=!0,we=0,ke=0,Te="X",xe=!1,Se=null,Ce=null,_e=t.util.now();m(e),this.subscribe=function(e){m(e),h()},this.execute=function(){h()},this.close=function(){d()},this.disconnect=function(){l()},this.getUrl=function(){return fe.url},this.push=function(e,t){if(null!=t){var n=fe.dispatchUrl;fe.dispatchUrl=t,z(e),fe.dispatchUrl=n}else z(e)},this.getUUID=function(){return fe.uuid},this.pushLocal=function(e){V(e)},this.enableProtocol=function(e){return fe.enableProtocol},this.init=function(){o()},this.request=fe,this.response=pe}},t.subscribe=function(e,n,r){"function"==typeof n&&t.addCallback(n),"string"!=typeof e?r=e:r.url=e,i="undefined"!=typeof r&&"undefined"!=typeof r.uuid?r.uuid:0;var a=new t.AtmosphereRequest(r);return a.execute(),o[o.length]=a,a},t.unsubscribe=function(){if(o.length>0)for(var e=[].concat(o),t=0;t<e.length;t++){var n=e[t];n.close(),clearTimeout(n.response.request.id),n.heartbeatTimer&&clearTimeout(n.heartbeatTimer)}o=[],r=[]},t.unsubscribeUrl=function(e){var t=-1;if(o.length>0)for(var n=0;n<o.length;n++){var r=o[n];if(r.getUrl()===e){r.close(),clearTimeout(r.response.request.id),r.heartbeatTimer&&clearTimeout(r.heartbeatTimer),t=n;break}}t>=0&&o.splice(t,1)},t.addCallback=function(e){t.util.inArray(e,r)===-1&&r.push(e)},t.removeCallback=function(e){var n=t.util.inArray(e,r);n!==-1&&r.splice(n,1)},t.util={browser:{},parseHeaders:function(e){for(var t,n=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,o={};t=n.exec(e);)o[t[1]]=t[2];return o},now:function(){return(new Date).getTime()},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},inArray:function(e,t){if(!Array.prototype.indexOf){for(var n=t.length,o=0;o<n;++o)if(t[o]===e)return o;return-1}return t.indexOf(e)},isBinary:function(e){return/^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(e))},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},getAbsoluteURL:function(e){if("undefined"==typeof document.createElement)return e;var t=document.createElement("div");return t.innerHTML='<a href="'+e+'"/>',encodeURI(decodeURI(t.firstChild.href))},prepareURL:function(e){var n=t.util.now(),o=e.replace(/([?&])_=[^&]*/,"$1_="+n);return o+(o===e?(/\?/.test(e)?"&":"?")+"_="+n:"")},trim:function(e){return String.prototype.trim?e.toString().trim():e.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},param:function(e){function n(e,n){n=t.util.isFunction(n)?n():null==n?"":n,i.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}function o(e,r){var i;if(t.util.isArray(r))t.util.each(r,function(t,r){/\[\]$/.test(e)?n(e,r):o(e+"["+("object"==typeof r?t:"")+"]",r)});else if("[object Object]"===Object.prototype.toString.call(r))for(i in r)o(e+"["+i+"]",r[i]);else n(e,r)}var r,i=[];for(r in e)o(r,e[r]);return i.join("&").replace(/%20/g,"+")},storage:function(){try{return!(!window.localStorage||!window.StorageEvent)}catch(e){return!1}},iterate:function(e,t){var n;return t=t||0,function o(){n=setTimeout(function(){e()!==!1&&o()},t)}(),function(){clearTimeout(n)}},each:function(e,n,o){if(e){var r,i=0,a=e.length,s=t.util.isArray(e);if(o){if(s)for(;i<a&&(r=n.apply(e[i],o),r!==!1);i++);else for(i in e)if(r=n.apply(e[i],o),r===!1)break}else if(s)for(;i<a&&(r=n.call(e[i],i,e[i]),r!==!1);i++);else for(i in e)if(r=n.call(e[i],i,e[i]),r===!1)break;return e}},extend:function(e){var t,n,o;for(t=1;t<arguments.length;t++)if(null!=(n=arguments[t]))for(o in n)e[o]=n[o];return e},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},off:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},log:function(e,t){if(window.console){var n=window.console[e];"function"==typeof n&&n.apply(window.console,t)}},warn:function(){t.util.log("warn",arguments)},info:function(){t.util.log("info",arguments)},debug:function(){t.util.log("debug",arguments)},error:function(){t.util.log("error",arguments)},xhr:function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},parseJSON:function(e){return e?window.JSON&&window.JSON.parse?window.JSON.parse(e):new Function("return "+e)():null},stringifyJSON:function(e){function t(e){return'"'+e.replace(o,function(e){var t=r[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'}function n(e){return e<10?"0"+e:e}var o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return window.JSON&&window.JSON.stringify?window.JSON.stringify(e):function e(o,r){var i,s,c,u,l=r[o],d=typeof l;switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(o),d=typeof l),d){case"string":return t(l);case"number":return isFinite(l)?String(l):"null";case"boolean":return String(l);case"object":if(!l)return"null";switch(Object.prototype.toString.call(l)){case"[object Date]":return isFinite(l.valueOf())?'"'+l.getUTCFullYear()+"-"+n(l.getUTCMonth()+1)+"-"+n(l.getUTCDate())+"T"+n(l.getUTCHours())+":"+n(l.getUTCMinutes())+":"+n(l.getUTCSeconds())+'Z"':"null";case"[object Array]":for(c=l.length,u=[],i=0;i<c;i++)u.push(e(i,l)||"null");return"["+u.join(",")+"]";default:u=[];for(i in l)a.call(l,i)&&(s=e(i,l),s&&u.push(t(i)+":"+s));return"{"+u.join(",")+"}"}}}("",{"":e})},checkCORSSupport:function(){if(t.util.browser.msie&&!window.XDomainRequest&&+t.util.browser.version.split(".")[0]<11)return!0;if(t.util.browser.opera&&+t.util.browser.version.split(".")<12)return!0;if("KreaTVWebKit/531"===t.util.trim(navigator.userAgent).slice(0,16))return!0;if("kreatel"===t.util.trim(navigator.userAgent).slice(-7).toLowerCase())return!0;var e=navigator.userAgent.toLowerCase(),n=e.match(/.+android ([0-9]{1,2})/i),o=parseInt(n&&n[0]||-1,10);return!isNaN(o)&&o>-1&&o<3}},e=t.util.now(),function(){var e=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(e)||e.indexOf("android")<0&&/version\/(.+) (safari)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];"safari"===n[2]&&(n[2]=n[1],n[1]="safari"),t.util.browser[n[1]||""]=!0,t.util.browser.version=n[2]||"0",t.util.browser.vmajor=t.util.browser.version.split(".")[0],t.util.browser.trident&&(t.util.browser.msie=!0),(t.util.browser.msie||t.util.browser.mozilla&&1===+t.util.browser.version.split(".")[0])&&(t.util.storage=!1)}(),t.util.on(window,"unload",function(e){t.util.debug(new Date+" Atmosphere: unload event"),t.unsubscribe()}),t.util.on(window,"beforeunload",function(e){t.util.debug(new Date+" Atmosphere: beforeunload event"),t._beforeUnloadState=!0,setTimeout(function(){t.util.debug(new Date+" Atmosphere: beforeunload event timeout reached. Reset _beforeUnloadState flag"),t._beforeUnloadState=!1},5e3)}),t.util.on(window,"keypress",function(e){27!==e.charCode&&27!==e.keyCode||e.preventDefault&&e.preventDefault()}),t.util.on(window,"offline",function(){if(t.util.debug(new Date+" Atmosphere: offline event"),n=!0,o.length>0)for(var e=[].concat(o),r=0;r<e.length;r++){var i=e[r];i.request.handleOnlineOffline&&(i.close(),clearTimeout(i.response.request.id),i.heartbeatTimer&&clearTimeout(i.heartbeatTimer))}}),t.util.on(window,"online",function(){if(t.util.debug(new Date+" Atmosphere: online event"),o.length>0)for(var e=0;e<o.length;e++)o[e].request.handleOnlineOffline&&(o[e].init(),o[e].execute());n=!1}),t})},{}],2:[function(e,t,n){!function(e,o){"use strict";var r=function(e){if("object"!=typeof e.document)throw new Error("Cookies.js requires a `window` with a `document` object");var t=function(e,n,o){return 1===arguments.length?t.get(e):t.set(e,n,o)};return t._document=e.document,t._cacheKeyPrefix="cookey.",t._maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),t.defaults={path:"/",secure:!1},t.get=function(e){t._cachedDocumentCookie!==t._document.cookie&&t._renewCache();var n=t._cache[t._cacheKeyPrefix+e];return n===o?o:decodeURIComponent(n)},t.set=function(e,n,r){return r=t._getExtendedOptions(r),r.expires=t._getExpiresDate(n===o?-1:r.expires),t._document.cookie=t._generateCookieString(e,n,r),t},t.expire=function(e,n){return t.set(e,o,n)},t._getExtendedOptions=function(e){return{path:e&&e.path||t.defaults.path,domain:e&&e.domain||t.defaults.domain,expires:e&&e.expires||t.defaults.expires,secure:e&&e.secure!==o?e.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){if(n=n||new Date,"number"==typeof e?e=e===1/0?t._maxExpireDate:new Date(n.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){e=e.replace(/[^#$&+\^`|]/g,encodeURIComponent),e=e.replace(/\(/g,"%28").replace(/\)/g,"%29"),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),n=n||{};var o=e+"="+t;return o+=n.path?";path="+n.path:"",o+=n.domain?";domain="+n.domain:"",o+=n.expires?";expires="+n.expires.toUTCString():"",o+=n.secure?";secure":""},t._getCacheFromString=function(e){for(var n={},r=e?e.split("; "):[],i=0;i<r.length;i++){var a=t._getKeyValuePairFromCookieString(r[i]);n[t._cacheKeyPrefix+a.key]===o&&(n[t._cacheKeyPrefix+a.key]=a.value)}return n},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");t=t<0?e.length:t;var n,o=e.substr(0,t);try{n=decodeURIComponent(o)}catch(e){console&&"function"==typeof console.error&&console.error('Could not decode cookie with key "'+o+'"',e)}return{key:n,value:e.substr(t+1)}},t._renewCache=function(){t._cache=t._getCacheFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="cookies.js",n="1"===t.set(e,1).get(e);return t.expire(e),n},t.enabled=t._areEnabled(),t},i="object"==typeof e.document?r(e):r;"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof n?("object"==typeof t&&"object"==typeof t.exports&&(n=t.exports=i),n.Cookies=i):e.Cookies=i}("undefined"==typeof window?this:window)},{}],3:[function(e,t,n){t.exports={atmosphere:{connectTimeout:1e4,timeout:864e4,reconnectInterval:5e3,transport:"websocket",fallbackTransport:"long-polling",tref:"websocket or long-polling",enableXDR:!0,shared:!1,authInterval:30,maxAuthTentatives:1e3,finalAuthTentatives:2e3,infoInterval:1e3,maxInfoTentatives:15,idleTimeOutSec:10,pollTimeOutSec:1},queue:{maxmsgdisconnected:1e3,maxlinks:100},cookie:{prefix:"brainify",days:365,secure:!1,visit:"visitck",visitor:"visitorck"},exint:{sens:25,timeout:500}}},{}],4:[function(e,t,n){t.exports={version:"0.5.22"}},{}],5:[function(e,t,n){var o=e("../brainifyconfig"),r="brt-"+e("../package").version;o.version=r;var i;i=e("./production"),o.debug=i.debug,o.dumpMode=i.dumpMode,o.forceAuth=i.forceAuth,o.atmosphere.trackerurl=i.atmosphere.trackerurl,o.queue.maxms=i.queue.maxms,o.queue.maxmsg=i.queue.maxmsg,t.exports=o},{"../brainifyconfig":3,"../package":4,"./development":12,"./production":14,"./staging":21}],6:[function(e,t,n){function o(e){try{return document.getElementsByTagName(e)}catch(e){return[]}}function r(e){try{if(document.getElementById)return document.getElementById(e);if(document.all)return window.document.all[e];if(document.layers)return window.document.layers[e]}catch(e){return}}function i(e,t){if(t||(t=document.getElementsByTagName("body")[0]),t.getElementsByClassName)return t.getElementsByClassName(e);var n=[];return a(document.body,function(e){var t,o,r=e.className;if(r)for(t=r.split(" "),o=0;o<t.length;o++)if(t[o]===className){n.push(e);break}}),n}function a(e,t){for(t(e),e=e.firstChild;e;)a(e,t),e=e.nextSibling}n.isElementInViewport=function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},n.getOneBy=function(e,t){switch(e){case"tag":var n=o(t);return n.length?n[0]:void 0;case"class":var n=i(t);return n.length?n[0]:void 0;case"id":return r(t);default:return}},n.getTagContent=function(e){var t="na";try{t=e.innerText||e.textContent||e.innerHTML}catch(e){return t}return t},n.getElementsByTag=o,n.getElementsByClass=i,n.getAttribute=function(e,t){if(!e)return null;var n=e.getAttribute&&e.getAttribute(t)||null;if(!n)for(var o=e.attributes,r=o.length,i=0;i<r;i++)if(o[i].nodeName===t)try{n=o[i].value||o[i].nodeValue;break}catch(e){}return n},n.getMeta=function(e,t,n){var r="na";try{var i=o("meta");if(i.length)for(var a=0;a<i.length;a++){var s=this.getAttribute(i[a],e);if(s&&s==t){var c=this.getAttribute(i[a],n);c&&c.length&&(r=c);break}}}catch(e){}return r},n.getReferrer=function(){var e="";try{e=window.top.document.referrer}catch(t){if(window.parent)try{e=window.parent.document.referrer}catch(t){e=""}}try{""===e&&(e=document.referrer)}catch(e){}return""==e&&(e="na"),e},n.getUa=function(){var e="na";try{e=navigator.userAgent}catch(e){}return e},n.getProductId=function(e,t,n,r){var i="na";try{var a=o(e);if(a.length)for(var s=0;s<a.length;s++){var c=this.getAttribute(a[s],t);if(c&&c==n){var u=this.getAttribute(a[s],r);u&&u.length&&(i=u);break}}}catch(e){}return i},n.getPageSize=function(){var e=-1,t=-1;try{var n=document.body,o=document.documentElement;t=Math.max(n.scrollHeight,n.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight)}catch(e){}try{var n=document.body,o=document.documentElement;e=Math.max(o.clientWidth,n.scrollWidth,o.scrollWidth,n.offsetWidth,o.offsetWidth)}catch(e){}return[e,t]},n.getBrowserLanguage=function(){var e="na";try{e=window.navigator.userLanguage||window.navigator.language}catch(e){}return e},n.getScreenInfo=function(){try{return[screen.width,screen.height,screen.availWidth,screen.availHeight,screen.colorDepth]}catch(e){}return[-1,-1,-1,-1,-1]}},{}],7:[function(e,t,n){n.various=e("./various.js"),n.dom=e("./dom.js"),n.microdata=e("./microdata.js"),n.json=e("./json.js")},{"./dom.js":6,"./json.js":8,"./microdata.js":9,"./various.js":10}],8:[function(require,module,exports){var j;j="undefined"==typeof JSON||null===JSON?{}:JSON,j.stringify=j.stringify||function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,o,r=[],i=e&&e.constructor==Array;for(n in e)o=e[n],t=typeof o,"string"==t?o='"'+o+'"':"object"==t&&null!==o&&(o=j.stringify(o)),r.push((i?"":'"'+n+'":')+String(o));return(i?"[":"{")+String(r)+(i?"]":"}")},j.parse=j.parse||function(str){return""===str&&(str='""'),eval("var p="+str+";"),p},module.exports=j},{}],9:[function(e,t,n){function o(){var e=[],t=[];try{for(var n=document.querySelectorAll("[itemprop]"),o="",s={},c=0;c<n.length&&!(n[c].offsetWidth+n[c].offsetHeight>0&&(o=n[c].getAttribute("itemprop"))&&(s={prop:o,id:a(),val:r(n[c])},e.push(s),t.push({el:n[c],id:s.id,prop:s.prop}),e.length>100));c++);}catch(e){i(e)}return{data:e,dom:t}}function r(e){var t=s[e.tagName.toLowerCase()]||s["*"],n=e[t]||e.getAttribute(t);if("string"==typeof n||n instanceof String){if(0==n.length)return;if(n=n.replace(/^\s+|\s+$/gm,""),0==n.length)return;n.length>1e3&&(n=n.substring(0,1e3))}else n="";return n}t.exports=o;var i=e(".").various.log,a=e(".").various.uuid,s={"*":"textContent",meta:"content",audio:"src",embed:"src",iframe:"src",img:"src",source:"src",video:"src",a:"href",area:"href",link:"href",object:"data",time:"datetime"}},{".":7}],10:[function(e,t,n){var o=e("../brainifyConfig");n.log=function(e){o.debug&&console.log(e)},n.uuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},n.getScheme=function(){try{return"https:"===document.location.protocol?"https://":"http://"}catch(e){return"http://"}}},{"../brainifyConfig":5}],11:[function(e,t,n){var o,r=e("../btutil").various.log,i=e("../btutil").various.getScheme,a=e("../brainifyConfig"),s=e("../tracker/errorHandler.js"),c=e("../btutil").json,u=!1,l="",d=function(){},f=function(){},p=e("./../../bower_components/atmosphere.js/atmosphere.js");n.init=function(e){var t=new p.AtmosphereRequest;t.url=i()+e+"."+a.atmosphere.trackerurl+"/tracker",t.connectTimeout=a.atmosphere.connectTimeout,t.reconnectInterval=a.atmosphere.reconnectInterval,t.logLevel=a.debug?"debug":"error",t.transport=a.atmosphere.transport,t.fallbackTransport=a.atmosphere.fallbackTransport,t.enableXDR=a.atmosphere.enableXDR,t.shared=a.atmosphere.shared,t.timeout=a.atmosphere.timeout,t.onOpen=function(e){e&&e.transport&&(l=" - "+e.transport),r("CO "+l),u=!0,s.setPublic("status","open"+l)},t.onReopen=function(e){e&&e.transport&&(l=" - "+e.transport),r("CRO "+l),u=!0,s.setPublic("status","reopen"+l)},t.onTransportFailure=function(e,t){r("CTF"),s.logErr("tran"),u=!1,s.setPublic("status","transp fail")},t.onMessage=function(e){if(d)try{var t=c.parse(e.responseBody);d(t)}catch(t){d(e,"JSON ko")}},t.onClose=function(e){f(),r("CCL"),u=!1,s.setPublic("status","close")},t.onError=function(e){s.logErr("cerr"),r("CER"),u=!1,s.setPublic("status","err")},t.onReconnect=function(e,t){t&&t.transport&&(l=" - "+t.transport),r("CRE"+l),s.setPublic("status","reconn"+l)},r("COK"),o=p.subscribe(t)},n.connected=function(){return u},n.transport=function(){return l},n.stop=function(){p.unsubscribe(),r("CST"),s.setPublic("status","stop")},n.setMessageHandler=function(e){d=e},n.getMessageHandler=function(){return d},n.setCloseHandler=function(e){f=e},n.send=function(e){var t;return a.dumpMode&&(t=c.stringify(e),r(t)),!!u&&(a.dumpMode||(t=c.stringify(e)),o.push(t),!0)}},{"../brainifyConfig":5,"../btutil":7,"../tracker/errorHandler.js":24,"./../../bower_components/atmosphere.js/atmosphere.js":1}],12:[function(e,t,n){t.exports={debug:!0,dumpMode:!0,forceAuth:!1,atmosphere:{trackerurl:"col.brainify.io"},queue:{maxms:1e3,maxmsg:10}}},{}],13:[function(e,t,n){(function(n){t.exports=n&&n.brainifytracker||function(){function t(t){if(!t.account_key)return o("NK");var n=e("./connection");n.init(t.account_key);var r=e("./tracker"),a=new r(t,i,n,function(){var r=e("./recommender");r.init(a),n.setMessageHandler(r.handlerecommendation),o("IOK "+t.account_key)})}var n=e("./brainifyConfig"),o=e("./btutil").various.log,r=e("./tracker/rtIntegration"),i={version:n.version,status:"starting",error:"na",injectMsg:function(){return"na"}},a=e("./tracker/errorHandler.js");a.init(i);var s=r.checkForAuthAndFlavour();return s.account_key?(o("AKPS"),t(s)):(o("AKNPW"),r.hookBrt(function(e){o("AKPNS"),r.deHookBrt(),t(e)})),i}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./brainifyConfig":5,"./btutil":7,"./connection":11,"./recommender":18,"./tracker":26,"./tracker/errorHandler.js":24,"./tracker/rtIntegration":29}],14:[function(e,t,n){t.exports={debug:!1,dumpMode:!1,forceAuth:!1,atmosphere:{trackerurl:"col.brainify.io"},queue:{maxms:2e3,maxmsg:100}}},{}],15:[function(e,t,n){var o=e("../btutil").various.log,r=e("./util").replaceElement,i=0,a=e("./events"),s=e("../tracker/event"),c=e("./util").handleCountdown,u=function(e,t){return"-webkit-"+e+": "+t+"; "+e+": "+t+";"},l={top:{0:{x:"0",y:"-3000px"},60:{x:"0",y:"25px"},75:{x:"0",y:"-10px"},90:{x:"0",y:"5px"}},left:{0:{x:"-3000px",y:"0"},60:{x:"25px",y:"0"},75:{x:"-10px",y:"0"},90:{x:"5px",y:"0"}}},d=function(e){return" { from, 60%, 75%, 90%, to {"+u("animation-timing-function","cubic-bezier(0.215, 0.610, 0.355, 1.000)")+"} 0% {opacity: 0;"+u("transform","translate3d("+l[e][0].x+","+l[e][0].y+", 0)")+"} 60% {opacity: 1; "+u("transform","translate3d("+l[e][60].x+","+l[e][60].y+", 0)")+"} 75% {"+u("transformtranslate3d("+l[e][75].x+","+l[e][75].y+", 0)")+"} 90% {"+u("transform","translate3d("+l[e][90].x+","+l[e][90].y+", 0)")+"} to {"+u("transform","none")+"}}"},f={base:function(e){return" ."+e+" {"+u("animation-duration","1.4s")+u("fill-mode","both")+u("backface-visibility","visible !important")+u("animation-name",e)+"}"},slidein:" { from {"+u("transform","perspective(400px) rotate3d(1, 0, 0, 90deg)")+u("animation-timing-function","ease-in")+"opacity: 0; } 40% {"+u("transform","perspective(400px) rotate3d(1, 0, 0, -20deg)")+u("animation-timing-function","ease-in")+"} 60% {"+u("transform","perspective(400px) rotate3d(1, 0, 0, 10deg)")+"opacity: 1; } 80% {"+u("transform","perspective(400px) rotate3d(1, 0, 0, -5deg)")+"} to {"+u("transform","perspective(400px)")+"}}",enterfromtop:" { from {opacity: 0;"+u("transform","translate3d(0, -100%, 0)")+"} to {opacity: 1;"+u("transform","none")+"}}",bouncefromtop:d("top"),hoverable:d("left"),bouncefromleft:d("left")},p=function(e,t){if(!f[e])return"na";var n="";switch(e){case"hoverable":n=".hoverable {left: "+(t.left||"-10px")+"} .hoverable:hover {left: 0; "+u("transition","ease-in-out, .55s ease-in-out")+"} "}return n+"@-webkit-keyframes "+e+f[e]+" @keyframes "+e+f[e]+f.base(e)};n.show=function(e){if(e.co)try{var t,n=e.at||"slidein";i++;var u="brtani"+i,l=e.co.trim(),d=new RegExp("<(\\w+)(\\s|>)"),f=d.exec(l);if(!f||f.length<2)return;t=document.createElement(f[1]),document.body.appendChild(t);var m=r(t,e.co);m.id=u;var g=document.createElement("style");if("brtcustom"==n&&e.acss)g.innerHTML=e.acss;else{var v="",h={};"hoverable"==n&&(h.left=m.style.left),"na"==(v=p(n,h))?o("UNST"):g.innerHTML=v}document.body.appendChild(g),m.className+=" "+n,"hoverable"==n&&(m.style.left="");var b=document.querySelector("#"+u+" #brtanibtn");try{b&&s.bind(b,"click",function(){m.parentNode.removeChild(m),g.parentNode.removeChild(g)})}catch(e){o(e)}c(u,[m,g],-1),a.fireAndSetup(e,u,m)}catch(e){o(e)}}},{"../btutil":7,"../tracker/event":25,"./events":16,"./util":20}],16:[function(e,t,n){(function(t){function o(e){try{for(var t=0;t<c.length;t++)a.unBind(c.domId[t].domEl,"mouseenter",c.domId[t].over),a.unBind(c.domId[t].domEl,"click",c.domId[t].click),delete c.domId}catch(e){r(e)}}var r=e("../btutil").various.log,i=e("../btutil").dom.isElementInViewport,a=e("../tracker/event"),s=[],c={};n.fireAndSetup=function(e,n,o){var i=[];try{i=document.querySelectorAll("#"+n+" [brtid]")}catch(e){r(e)}var a=e.id?e.id:-1,s=e.nty?e.nty:"",d=e.te?e.te:"",f=e.pl?e.pl:"",p=e.cm?e.cm:"",m=e.nd?e.nd:"";t._$brt.push(["nudgePrinted",{dom_id:n,id:a,nty:s,te:d,pl:f,cm:p,nd:m}]);for(var g=0;g<i.length;g++)t._$brt.push(["nudgePrinted",{brtel:!0,brtid:i[g].getAttribute("brtid")||"",dom_id:n,id:a,nty:s,te:d,pl:f,cm:p,nd:m}]);c.domId=[],u(!1,"main",n,a,s,d,f,p,m,o);for(var v=0;v<i.length;v++)u(!0,i[v].getAttribute("brtid")||"",n,a,s,d,f,p,m,i[v]);l([-1,"sc"])};var u=function(e,n,o,i,u,l,d,f,p,m){var g={dom_id:o,id:i,nty:u,te:l,pl:d,cm:f,nd:p};e&&(g.brtel=!0,g.brtid=n);var v=function(){t._$brt.push(["nudgeHovered",g])},h=function(){t._$brt.push(["nudgeClicked",g])};a.bind(m,"mouseenter",v),a.bind(m,"click",h);var b={dom_id:o,domEl:m,id:i,nty:u,te:l,pl:d,cm:f,nd:p};e&&(b.brtel=!0,b.brtid=n),c.domId.push({domEl:m,click:h,over:v}),s.push(b),r(o+"-"+n+" + "+s.length)},l=function(e){if("sc"==e[1]||"rs"==e[1])for(var n=s.length,o=0;o<n;o++)if(i(s[o].domEl)){var r=s[o].dom_id,a=s[o].id,c=s[o].nty,u=s[o].te,l=s[o].pl,d=s[o].cm,f=s[o].nd,p={dom_id:r,id:a,nty:c,te:u,pl:l,cm:d,nd:f};s[o].brtel&&(p.brtel=!0,p.brtid=s[o].brtid),t._$brt.push(["nudgeViewed",p]),s.splice(o,1),n=s.length}};n.checkVisibilityChanges=l,n.removeNudge=function(e){for(var t=0;t<s.length;t++)s[t].dom_id==e&&s.splice(t,1);o(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../btutil":7,"../tracker/event":25}],17:[function(e,t,n){var o=e("../btutil").various.log,r=e("../brainifyConfig"),i=e("./../../bower_components/cookies-js/dist/cookies.js"),a=e("./events"),s=e("../tracker/event"),c="exitNudge",u=!1,l=!1,d="",f=0,p=!1,m=2e4,g=function(){},v=function(e){if(!u&&e.clientY<=r.exint.sens)if(l){u=!0,i.enabled&&i.set(r.cookie.prefix+"."+c,1),f++;var t=document.createElement("div"),n="brtexi"+f;t.id=n,t.innerHTML=d.co,document.body.appendChild(t);var v=document.getElementById("brtexitintbtn");try{v&&s.bind(v,"click",function(){t.parentNode.removeChild(t)})}catch(e){o(e)}var h=document.getElementById("brtexitintfrm");try{h&&s.bind(h,"submit",function(e){if(e.preventDefault(),!p){p=!0;try{for(var t=h.getElementsByClassName("brtFormVal"),r=new FormData,i=0;i<t.length;i++)r.append(t[i].name,t[i].value);var a=new XMLHttpRequest;a.timeout=m,a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status){o(a.responseText);try{var e=document.querySelector("#"+n+" .brtFormConfirm");h.style.display="none",e.style.display="block"}catch(e){o(e)}}p=!1}},a.onerror=function(){o("Error while submitting form"),p=!1},a.ontimeout=function(){o("Timeout while submitting form"),p=!1},a.open("post",h.getAttribute("action")||"/"),a.send(r)}catch(e){o(e),p=!1}}return!1})}catch(e){o(e)}a.fireAndSetup(d,n,t),s.unbind(document.documentElement,"mouseleave",g),o("EIFI")}else o("EINA")};n.handler=v,n.save=function(e){e.co&&(d=e,l=!0,o("EISV"))},n.setup=function(){var e=!1;if(i.enabled){var t=i.get(r.cookie.prefix+"."+c);t&&1==t&&(e=!0,o("EICF"))}e||setTimeout(function(){g=function(e){v(e)},s.bind(document.documentElement,"mouseleave",g),o("EIST")},r.exint.timeout)}},{"../brainifyConfig":5,"../btutil":7,"../tracker/event":25,"./../../bower_components/cookies-js/dist/cookies.js":2,"./events":16}],18:[function(e,t,n){var o,r=e("../btutil").various.log,i=e("../tracker/pageInfo.js"),a=e("../tracker/cookie.js"),s=e("../tracker/authorizer"),c=e("./nudge.js"),u=e("./events.js"),l=e("../tracker/errorHandler.js");n.init=function(e){o=e,o.recEventsHandler=u.checkVisibilityChanges,r("ROK")},n.handlerecommendation=function(t,n){return n?void r("!"):t?void(t.error?(a.setAll(t,o),100==Number(t.error)?(r("100"),s.authorize(o,function(t,n){return t?(l.setPublic("status","auth"+n),o.connection.setMessageHandler(e("../recommender").handlerecommendation),void i.sendPageInfo(o)):(o.connection.stop(),void r("RAF"))})):101==Number(t.error)?i.sendPageInfo(o):r("?")):c.handle(t)):r("*")}},{"../btutil":7,"../recommender":18,"../tracker/authorizer":22,"../tracker/cookie.js":23,"../tracker/errorHandler.js":24,"../tracker/pageInfo.js":27,"./events.js":16,"./nudge.js":19}],19:[function(e,t,n){function o(e){if(e.po&&e.se){var t=document.querySelector(e.se);if(t){a++;var n,o="brttrk"+a;if("in"==e.po)e.co&&(t.innerHTML=e.co),t.id=o,n=t,c.fireAndSetup(e,o,n);else try{if(!e.co)return;var r=e.co.trim(),i=new RegExp("<(\\w+)(\\s|>)"),u=i.exec(r);if(!u||u.length<2)return;switch(n=document.createElement(u[1]),e.po){case"be":t.parentNode.insertBefore(n,t);break;case"af":t.parentNode.insertBefore(n,t.nextSibling)}var l=d(n,e.co);l.id=o,c.fireAndSetup(e,o,l)}catch(e){s(e)}}}}function r(e){if(e.co){a++;var t=document.createElement("div"),n="brttrk"+a;t.id=n,e.co&&(t.innerHTML=e.co),document.body.appendChild(t);var o=document.querySelector("#"+n+" #brtmodalbtn");try{o&&f.bind(o,"click",function(){t.parentNode.removeChild(t),c.removeNudge(i(n))})}catch(e){s(e)}var r=e.to||4e3;r!=-1&&setTimeout(function(){t.parentNode.removeChild(t),c.removeNudge(i(n))},r),c.fireAndSetup(e,n,t)}}function i(e){return e.substr(6)}var a=0,s=e("../btutil").various.log,c=e("./events"),u=e("./exit"),l=e("./animated"),d=e("./util").replaceElement,f=e("../tracker/event");n.handle=function(e){return s(e),!e.ty||"p"!=e.ty&&"m"!=e.ty?e.ty&&"di"==e.ty?o(e):e.ty&&"e"==e.ty?u.save(e):e.ty&&"a"==e.ty?l.show(e):void 0:r(e)}},{"../btutil":7,"../tracker/event":25,"./animated":15,"./events":16,"./exit":17,"./util":20}],20:[function(e,t,n){function o(e){return e<10?"0"+e:e}function r(e,t){var n,r=o(parseInt(e/1e3%60)),a=o(parseInt(e/6e4%60)),s=o(parseInt(e/36e5%24)),c=parseInt(e/864e5);try{n=t.toLowerCase(),n=n.replace("hh",s),n=n.replace("mm",a),n=n.replace("ss",r),n=n.replace("d",c)}catch(e){i(e),n=c+" "+o(s)+":"+o(a)+":"+o(r)}return n}var i=e("../btutil").various.log;n.replaceElement=function(e,t){var n,o=!1;return null!==e.previousElementSibling?n=e.previousElementSibling:(n=e.parentElement,o=!0),e.outerHTML=t,o?n.firstElementChild:n.nextElementSibling};var a=function(e,t,n){var o=document.querySelector("#"+e+" #brtcountdown");try{if(o){var s;if(n==-1?(s=parseInt(document.querySelector("#"+e+" #brtcountdown").innerHTML),isNaN(s)&&(s=Date.now()+6e4)):s=n,s>Date.now()){var c=o.getAttribute("data-format");c&&""!=c||(c="hh:mm:ss"),o.innerHTML=r(s-Date.now(),c),setTimeout(function(){a(e,t,s)},1e3)}else try{for(var u=0;u<t.length;u++)t[u].parentNode.removeChild(t[u])}catch(e){i(e)}}}catch(e){i(e)}};n.handleCountdown=a},{"../btutil":7}],21:[function(e,t,n){t.exports={debug:!1,dumpMode:!1,forceAuth:!1,atmosphere:{trackerurl:"col.brainify.io"},queue:{maxms:100,maxmsg:100}}},{}],22:[function(e,t,n){var o=e("../btutil").various.log,r=e("../brainifyConfig"),i=e("./cookie.js");n.authorize=function(e,t){function n(){if(c++,a.connected()&&a.send(s))return o("ASN");if(c<r.atmosphere.maxAuthTentatives)setTimeout(n,r.atmosphere.authInterval);else{if(!(c<r.atmosphere.finalAuthTentatives))return o("ANS"),t(!1);setTimeout(n,2*r.atmosphere.authInterval)}}var a=e.connection,s={client_key:e.account_key,agent_version:r.version,init_data:e.init_obj};e.session_uuid&&(s.session_uuid=e.session_uuid),e.visitor_uuid&&(s.visitor_uuid=e.visitor_uuid);var c=0;return r.forceAuth?t(!0," - forced"):(a.setMessageHandler(function(n){return a.setMessageHandler(function(){}),"reject"==n.authorization?(o("AKO"),t(!1)):"ok"==n.authorization?(o("AOK"),i.setAll(n,e),t(!0,a.transport()+" - "+c)):(o("AKO"),void t(!1))}),void n())}},{"../brainifyConfig":5,"../btutil":7,"./cookie.js":23}],23:[function(e,t,n){var o=(e("../btutil").various.uuid,e("./../../bower_components/cookies-js/dist/cookies.js")),r=e("../brainifyConfig"),i=e("../btutil").json;n.getAll=function(){var e={enabled:"",visit:"",visitor:""};if(o.enabled){e.enabled=!0;var t=o.get(r.cookie.prefix+"."+r.cookie.visit);t&&(e.visit=t);var n=o.get(r.cookie.prefix+"."+r.cookie.visitor);
n&&(e.visitor=n)}else e.enabled=!1;return e},n.set=function(e,t){o.enabled&&o.set(r.cookie.prefix+"."+r.cookie[e],t,{secure:r.cookie.secure,expires:24*r.cookie.days*60*60})},n.setSession=function(e,t){o.enabled&&o.set(r.cookie.prefix+"."+r.cookie[e],t,{secure:r.cookie.secure})},n.setAll=function(e,t){e.session_uuid&&(t.session_uuid=e.session_uuid,n.setSession("visit",e.session_uuid)),e.visitor_uuid&&(t.visitor_uuid=e.visitor_uuid,n.set("visitor",e.visitor_uuid)),e.page_visit_uuid&&(t.init_obj.page_visit_uuid=e.page_visit_uuid,t.page_visit_uuid=e.page_visit_uuid)},n.getVisitor=function(){var e="undefined";if(o.enabled){var t=o.get(r.cookie.prefix+"."+r.cookie.visitor);t&&(e=t)}return e},n.addErr=function(e){var t=[];try{var n=o.get(r.cookie.prefix+"."+r.cookie.visitor+"err");n&&(t=i.parse(n))}catch(e){}t.length>20&&t.splice(0,1);var a=new Date;t.push([a.getTime(),a.getTimezoneOffset(),e]),o.enabled&&o.set(r.cookie.prefix+"."+r.cookie.visitor+"err",i.stringify(t),{secure:r.cookie.secure,expires:24*r.cookie.days*60*60})},n.getRefreshErr=function(){var e=[];try{var t=o.get(r.cookie.prefix+"."+r.cookie.visitor+"err");t&&(e=i.parse(t))}catch(e){}return o.enabled&&o.set(r.cookie.prefix+"."+r.cookie.visitor+"err",i.stringify([]),{secure:r.cookie.secure,expires:24*r.cookie.days*60*60}),e}},{"../brainifyConfig":5,"../btutil":7,"./../../bower_components/cookies-js/dist/cookies.js":2}],24:[function(e,t,n){var o=(e("../brainifyConfig"),e("./cookie.js")),r=(e("../btutil").various.log,{});n.init=function(e){r=e},n.setPublic=function(e,t){r[e]=t},n.logErr=function(e){try{n.setPublic("error",e)}catch(e){}try{o.addErr(e)}catch(e){}}},{"../brainifyConfig":5,"../btutil":7,"./cookie.js":23}],25:[function(e,t,n){function o(){return document.body.scrollTop||document.documentElement.scrollTop}var r=e("../btutil").dom,i=(e("../brainifyConfig"),void 0!==window.addEventListener?"addEventListener":"attachEvent"),a=void 0!==window.removeEventListener?"removeEventListener":"detachEvent",s="addEventListener"!==i?"on":"";n.bind=function(e,t,n,o){return e[i](s+t,n,o||!1),n},n.unbind=function(e,t,n,o){return e[a](s+t,n,o||!1),n},n.normalize=function(e,t){e=e||window.event;var n="na";switch(e.type){case"scroll":n="sc";break;case"mousemove":n="mv";break;case"click":n="cl";break;case"dblckick":n="dc";break;case"mousedown":n="do";break;case"mouseup":n="up";break;case"resize":n="rs";break;default:n="na"}if("scroll"==e.type)return[t,n,-1,o()];var i=e.pageX,a=e.pageY;void 0===i&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var s=r.getPageSize();"resize"==e.type&&(i=-1,a=-1);var c=[t,n,i,a,s[0],s[1]];return c}},{"../brainifyConfig":5,"../btutil":7}],26:[function(e,t,n){function o(e,t,n,o){var i=this,a=u.getAll();i.publicProperties=t,i.connection=n,i.opts=e,i.account_key=i.opts.account_key,i.session_uuid=a.visit,i.visitor_uuid=a.visitor,i.cookies_enabled=a.enabled,i.infoTentatives=0,i.init_obj={},m.sendByGet(i),c.authorize(i,function(e,t){return e?(l.setPublic("status","auth"+t),void i.init(o)):(l.logErr("auth"),i.connection.stop(),void r("AFA"))})}var r=e("../btutil").various.log,i=e("../brainifyConfig"),a=e("./event"),s=e("./timedqueue"),c=e("./authorizer"),u=e("./cookie.js"),l=e("./errorHandler.js"),d=e("./pageInfo.js"),f=e("./timeHandler"),p=(e("../btutil").various.uuid,e("./rtIntegration")),m=(e("../btutil").dom,e("./preSender")),g=e("./semantic"),v=e("../recommender/exit.js");o.prototype.init=function(e){var t=this;t.timeHandler=new f(t),t.recEventsHandler=function(e){},p.start(t),d.sendPageInfo(t,!1),t.connection.setCloseHandler(function(){d.sendCloseInfo(t)}),g.start(t),t.timedqueue=new s({maxms:i.queue.maxms,maxmsg:i.queue.maxmsg,maxmsgdisconnected:i.queue.maxmsgdisconnected,connection:t.connection,t:"m"},t.timeHandler),v.setup(),a.bind(window,"mousemove",function(e){t.mouseHandler(e)}),a.bind(window,"click",function(e){t.mouseHandler(e)}),a.bind(window,"dblclick",function(e){t.mouseHandler(e)}),a.bind(window,"mousedown",function(e){t.mouseHandler(e)}),a.bind(window,"mouseup",function(e){t.mouseHandler(e)}),a.bind(window,"scroll",function(e){t.mouseHandler(e)}),a.bind(window,"resize",function(e){t.mouseHandler(e)}),r("TST"),e()},o.prototype.mouseHandler=function(e){var t=a.normalize(e,this.timeHandler.getRelativeTime());this.timedqueue.push(t),this.recEventsHandler(t)},t.exports=o},{"../brainifyConfig":5,"../btutil":7,"../recommender/exit.js":17,"./authorizer":22,"./cookie.js":23,"./errorHandler.js":24,"./event":25,"./pageInfo.js":27,"./preSender":28,"./rtIntegration":29,"./semantic":30,"./timeHandler":31,"./timedqueue":32}],27:[function(e,t,n){function o(e,t){var n={t:"i",u:e.page_visit_uuid,v:{}};try{if(t){var o=new Date;n.v.st=o.getTime(),n.v.tz=o.getTimezoneOffset()}else n.v.st=e.timeHandler.getStartTime(),n.v.tz=e.timeHandler.getTimezoneOffset();n.v.ie={};try{n.v.ie.deviceXDPI=screen.deviceXDPI||"na",n.v.ie.logicalXDPI=screen.logicalXDPI||"na",n.v.ie.deviceYDPI=screen.deviceYDPI||"na",n.v.ie.logicalYDPI=screen.logicalYDPI||"na"}catch(e){}n.v.fl=e.opts.flavour_key?e.opts.flavour_key:"na",n.v.ck=e.opts.account_key,n.v.ce=e.cookies_enabled?"okCookies":"noCookies",n.v.vu=e.visitor_uuid,n.v.su=e.session_uuid,n.v.ho=window.location.host,n.v.ps=s.getPageSize(),n.v.si=s.getScreenInfo(),n.v.ln=s.getBrowserLanguage(),n.v.pa=window.location.pathname,n.v.qu=window.location.search,n.v.ha=window.location.hash,n.v.re=s.getReferrer(),n.v.sc=document.location.protocol;var r=s.getOneBy("tag","title");n.v.pt=r?s.getTagContent(r):"na";var a="na",d="na",f="na";if(e.opts.flavour_custom){try{if(e.opts.flavour_custom.category){var p=s.getOneBy(e.opts.flavour_custom.category.dimension,e.opts.flavour_custom.category.selector);p&&(a=s.getAttribute(p,e.opts.flavour_custom.category.attribute)),a||(a="na")}}catch(e){}try{e.opts.flavour_custom.meta&&(d=s.getMeta(e.opts.flavour_custom.meta.selector,e.opts.flavour_custom.meta.selectorValue,e.opts.flavour_custom.meta.attribute))}catch(e){}try{e.opts.flavour_custom.item_id&&(f=s.getProductId(e.opts.flavour_custom.item_id.tag,e.opts.flavour_custom.item_id.selector,e.opts.flavour_custom.item_id.selectorValue,e.opts.flavour_custom.item_id.attribute))}catch(e){}}n.v.ct=a,n.v.me=d,n.v.ii=f,t||(n.v.ua=s.getUa());var m={};m=t?c.readRtArray():c.composeRtArray(),n.v.rt=m.r,n.v.er=m.e}catch(e){i(e),l.logErr("pinf");try{u.addErr(e)}catch(e){}}try{n.v.he=u.getRefreshErr()}catch(e){}return n}function r(e,t,n){t.connection.send(n)||(e>0?(i("PSPI "+e),setTimeout(function(){r(e-1,t,n)},a.atmosphere.infoInterval)):l.logErr("psnd"))}var i=e("../btutil").various.log,a=e("../brainifyConfig"),s=e("../btutil").dom,c=e("./rtIntegration"),u=e("./cookie.js"),l=e("./errorHandler.js");n.sendPageInfo=function(e,t){var n=o(e,t||!1);r(a.atmosphere.maxInfoTentatives,e,n)},n.preparePageInfo=o,n.sendCloseInfo=function(e){var t={t:"c",u:e.page_visit_uuid,v:[]};t.v.push(e.visitor_uuid),t.v.push(e.session_uuid),t.v.push(e.timeHandler.getTotalTime()),t.v.push(e.timeHandler.getTotalActiveTime()),e.connection.send(t)}},{"../brainifyConfig":5,"../btutil":7,"./cookie.js":23,"./errorHandler.js":24,"./rtIntegration":29}],28:[function(e,t,n){function o(e,t,n,o,r){try{var u=i()+r+"."+a.atmosphere.trackerurl+"/s/pv?m="+encodeURIComponent(s.stringify(e));t&&(u+="&ns=1"),n&&(u+="&nv=1"),u+="&av="+encodeURIComponent(o);var l=document.createElement("img");l.src=u,l.width=1,l.height=1,l.border=0,l.style="display:none; height:1px; width:1px; border: 0; margin: 0; padding: 0",l.setAttribute("style","display:none; height:1px; width:1px; border: 0; margin: 0; padding: 0"),document.body.appendChild(l),c("PSNT")}catch(e){}}var r=e("./pageInfo.js").preparePageInfo,i=e("../btutil").various.getScheme,a=e("../brainifyConfig"),s=e("../btutil").json,c=e("../btutil").various.log,u=e("../btutil").various.uuid;n.sendByGet=function(e){var t=!1,n=!1;if(e.session_uuid||(e.session_uuid=u(),n=!0),e.visitor_uuid||(e.visitor_uuid=u(),t=!0),!e.page_visit_uuid){var i=u();e.page_visit_uuid=i,e.init_obj.page_visit_uuid=i}var s=r(e,!0);try{o(s,n,t,a.version,e.account_key)}catch(e){}}},{"../brainifyConfig":5,"../btutil":7,"./pageInfo.js":27}],29:[function(e,t,n){(function(t){function o(){var e={t:"r",u:l.page_visit_uuid,v:{t:l.timeHandler.getRelativeTime(),e:[]}},t={t:"e",u:l.page_visit_uuid,v:{t:l.timeHandler.getRelativeTime(),e:[]}},n=i();n.r.length&&(e.v.e=n.r,l.connection.send(e)),n.e.length&&(t.v.e=n.e,l.connection.send(t))}function r(){if("undefined"==typeof t._$brt)return[];for(var e=[],n=[],o=[],r=p.parse(p.stringify(t._$brt)),i=0;i<r.length;i++){o=r[i];try{if(o[0]instanceof Array)for(var s=0;s<o.length;s++)a(o[s],e,n);else a(o,e,n)}catch(e){e.message&&n.push(u(e.message))}}return{r:e,e:n}}function i(){if("undefined"==typeof t._$brt)return[];for(var e=[],n=[];rtItem=t._$brt.shift();)try{if(rtItem[0]instanceof Array)for(;rtSubItem=rtItem.shift();)a(rtSubItem,e,n);else a(rtItem,e,n)}catch(e){e.message&&n.push(u(e.message))}return{r:e,e:n}}function a(e,t,n){try{switch(e[0]){case"development_mode":m||e[1]!==!0||(m=!0,l.publicProperties.injectMsg=l.connection.getMessageHandler(),u("DON"));break;case"test_err":e.length>1&&f.logErr(e[1]);break;case"customer_id":case"customerAuthorized":case"visitorSubscribed":case"visitorRegistered":case"visitorConfirmedRegistration":case"page_type":case"category_id":case"categoryViewed":case"item_id":case"itemViewed":case"itemAdded":case"itemRemoved":case"orderFormed":case"orderPurchased":case"nudgePrinted":case"nudgeViewed":case"nudgeHovered":case"nudgeClicked":case"category_path":t.push({t:e[0],p:e[1]});break;case"_addEvent":case"_setApiKey":case"_registerRecommender":n.push(u("OLD CMD"));break;case"account_key":case"flavour_key":case"extractors":break;default:n.push(u("UNKN "+e[0]))}}catch(e){e.message&&n.push(u(e.message))}}function s(){var e={};if("undefined"==typeof t._$brt)return e;try{for(var n=0;n<t._$brt.length;n++)if(t._$brt[n][0]instanceof Array)for(var o=0;o<t._$brt[n].length;o++)c(t._$brt[n][o],e);else c(t._$brt[n],e)}catch(e){}return e}function c(e,t){try{"account_key"==e[0]?t.account_key=e[1]:"flavour_key"==e[0]?t.flavour_key=e[1]:"extractors"==e[0]&&(t.extractors=e[1])}catch(e){}}function u(e){return m&&console&&console.log(e),e}var l,d=e("../btutil").various.log,f=e("./errorHandler.js"),p=e("../btutil").json,m=!1;n.composeRtArray=i,n.readRtArray=r,n.checkForAuthAndFlavour=s,n.hookBrt=function(e){d("PHS"),t._$brt=t._$brt||[],t._$brt.push=function(){Array.prototype.push.apply(this,arguments);var n=s();return n.account_key&&e(n),t._$brt.length}},n.deHookBrt=function(){d("PHD"),t._$brt.push=function(){return Array.prototype.push.apply(this,arguments),t._$brt.length}},n.start=function(e){d("CEIS"),l=e,t._$brt.push=function(){return Array.prototype.push.apply(this,arguments),o(),0}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../btutil":7,"./errorHandler.js":24}],30:[function(e,t,n){function o(e,t,n){var o={t:"s",u:t,v:{t:"i",v:[]}};o.v.v=e,n.send(o)}function r(e,t){var n=function(n){var o={t:"s",u:e.page_visit_uuid,v:{t:"e",v:[]}},r="na";switch(n.type){case"mouseenter":r="in";break;case"mouseleave":r="out"}o.v.v.push(e.timeHandler.getRelativeTime()),o.v.v.push(t.id),o.v.v.push(r),o.v.v.push(t.prop),e.connection.send(o)};s.bind(t.el,"mouseenter",n),s.bind(t.el,"mouseleave",n)}var i=e("../btutil").various.log,a=e("../btutil").microdata,s=e("./event");n.start=function(e){var t=a();o(t.data,e.page_visit_uuid,e.connection),i("SSN");for(var n=0;n<t.dom.length;n++)r(e,t.dom[n]);i("SST "+t.dom.length)}},{"../btutil":7,"./event":25}],31:[function(e,t,n){function o(e){var t=new Date;this.startTime=t.getTime(),this.offset=t.getTimezoneOffset(),this.timeSpent=0,this.focusStart=this.startTime,this.connection=e.connection,this.page_visit_uuid=e.page_visit_uuid,this.active=!0,this.lastActive=this.startTime,this.startMonitor()}var r=e("../brainifyConfig"),i=e("./event");o.prototype.getStartTime=function(){return this.startTime},o.prototype.getTotalTime=function(){var e=(new Date).getTime();return e-this.startTime},o.prototype.getTotalActiveTime=function(){var e=this.timeSpent;if(this.active){var t=(new Date).getTime();e+=t-this.focusStart}return e},o.prototype.getTimezoneOffset=function(){return this.offset},o.prototype.startMonitor=function(){var e=this;i.bind(window,"mousemove",function(){e.captureActivity()}),i.bind(window,"keydown",function(){e.captureActivity()}),setInterval(function(){if(e.active){var t=(new Date).getTime();t-e.lastActive>1e3*r.atmosphere.idleTimeOutSec&&(e.active=!1,e.switchStatus("off"))}},1e3*r.atmosphere.pollTimeOutSec)},o.prototype.captureActivity=function(){this.lastActive=(new Date).getTime(),this.active||(this.active=!0,this.switchStatus("on"))},o.prototype.switchStatus=function(e){var t=this;if("on"==e)t.focusStart=(new Date).getTime(),t.connection.send({t:"a",u:t.page_visit_uuid,v:[t.getRelativeOf(t.focusStart),"on",t.timeSpent]});else{var n=(new Date).getTime();t.timeSpent+=n-t.focusStart,t.connection.send({t:"a",u:t.page_visit_uuid,v:[t.getRelativeOf(n),"off",t.timeSpent]})}},o.prototype.getRelativeTime=function(){return(new Date).getTime()-this.startTime},o.prototype.getRelativeOf=function(e){return e-this.startTime},t.exports=o},{"../brainifyConfig":5,"./event":25}],32:[function(e,t,n){function o(e,t){this.queue=[],this.timeHandler=t,this.startms=this.timeHandler.getRelativeTime(),this.maxms=e.maxms,this.maxmsg=e.maxmsg,this.maxmsgdisconnected=e.maxmsgdisconnected,this.connection=e.connection,this.t=e.t,this.todrop=Math.round(.1*this.maxmsgdisconnected),this.todrop=this.todrop>0?this.todrop:1;var n=this;setInterval(function(){n.push({},!0)},this.maxms)}var r=e("../btutil").various.log;o.prototype.push=function(e,t){var n=this.timeHandler.getRelativeTime();if(t||this.queue.push(e),0==this.queue.length)return void(this.startms=n);if(!this.connection.connected()){if(this.queue.length<=this.maxmsgdisconnected)return;return r("drop "+this.queue.length+" - "+this.todrop),void this.queue.splice(0,this.todrop)}if(n-this.startms>this.maxms||this.queue.length>=this.maxmsg){var o=this.queue.splice(0),i=this.connection.send({t:this.t,u:this.timeHandler.page_visit_uuid,v:o});this.startms=n,i||(r("rebuf"),this.queue=o)}},t.exports=o},{"../btutil":7}]},{},[13])(13)});